<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø¨Ø·ÙˆÙ„Ø© PES Mobile</title>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<style>
body{
  margin:0;
  font-family:'Cairo', Arial;
  background:radial-gradient(circle at top,#1a1a1a,#000);
  color:#fff;
  text-align:center;
}
.container{
  max-width:500px;
  margin:auto;
  padding:20px;
}
h1{
  color:#d4af37;
  text-shadow:0 0 10px #d4af37;
}
.counter{
  font-size:20px;
  margin:10px 0;
  color:#fff;
}
.top3{
  display:flex;
  justify-content:space-between;
  margin:15px 0;
}
.top3 div{
  flex:1;
  margin:5px;
  padding:10px;
  background:#111;
  border:1px solid #d4af37;
  border-radius:12px;
  box-shadow:0 5px 15px #000;
}
.team{
  background:linear-gradient(145deg,#111,#000);
  border:2px solid #d4af37;
  border-radius:15px;
  padding:15px;
  margin:12px 0;
  cursor:pointer;
  box-shadow:0 8px 0 #8c6d1f;
  transition:.3s;
}
.team:hover{
  transform:translateY(-3px);
}
.team:active{
  box-shadow:0 3px 0 #8c6d1f;
  transform:translateY(4px);
}
.taken{
  opacity:.35;
  pointer-events:none;
}
audio{
  display:none;
}
</style>
</head>

<body>

<audio autoplay loop>
  <source src="bg.mp3" type="audio/mpeg">
</audio>

<div class="container">
  <h1>ğŸ† Ø¨Ø·ÙˆÙ„Ø© PES Mobile</h1>

  <div class="counter" id="counter">0 / 32 Ù…Ø³Ø¬Ù„</div>

  <h3>ğŸ¥‡ Top 3</h3>
  <div class="top3">
    <div id="t1">---</div>
    <div id="t2">---</div>
    <div id="t3">---</div>
  </div>

  <h3>Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙØ±Ù‚</h3>
  <div id="teams"></div>
</div>

<script>
// ğŸ”¥ firebaseConfig Ø¯ÙŠØ§Ù„Ùƒ
const firebaseConfig = {
  apiKey: "XXXX",
  authDomain: "XXXX",
  databaseURL: "XXXX",
  projectId: "XXXX",
  storageBucket: "XXXX",
  messagingSenderId: "XXXX",
  appId: "XXXX"
};

firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const teamsRef = db.ref("teams");
const countRef = db.ref("count");
const topRef = db.ref("top3");

// Ø¹Ø±Ø¶ Ø§Ù„ÙØ±Ù‚
teamsRef.on("value", snap=>{
  const teams = snap.val();
  const box = document.getElementById("teams");
  box.innerHTML = "";
  for(let k in teams){
    const t = teams[k];
    const d = document.createElement("div");
    d.className = "team"+(t.taken?" taken":"");
    d.innerHTML = t.name;
    if(!t.taken){
      d.onclick = ()=> chooseTeam(k,t.name);
    }
    box.appendChild(d);
  }
});

// Ø§Ù„Ø¹Ø¯Ø§Ø¯
countRef.on("value", s=>{
  document.getElementById("counter").innerText =
    (s.val()||0)+" / 32 Ù…Ø³Ø¬Ù„";
});

// Top 3
topRef.on("value", s=>{
  const d = s.val()||{};
  document.getElementById("t1").innerText = d.one||"---";
  document.getElementById("t2").innerText = d.two||"---";
  document.getElementById("t3").innerText = d.three||"---";
});

function chooseTeam(key,name){
  if(!confirm("ØªØ£ÙƒÙŠØ¯ Ø§Ø®ØªÙŠØ§Ø± "+name)) return;

  teamsRef.child(key).transaction(t=>{
    if(t && !t.taken){
      t.taken = true;
      return t;
    }
    return;
  },(e,ok)=>{
    if(ok){
      countRef.transaction(c=>(c||0)+1);
      topRef.transaction(t=>{
        t=t||{};
        if(!t.one) t.one=name;
        else if(!t.two) t.two=name;
        else if(!t.three) t.three=name;
        return t;
      });
      location.href =
      "https://wa.me/212779225334?text="+
      encodeURIComponent("Ø³Ù„Ø§Ù…ØŒ Ø³Ø¬Ù„Øª Ø¨ÙØ±Ù‚Ø© "+name);
    }else alert("Ø§Ù„ÙØ±Ù‚Ø© ØªØ®Ø¯Ø§Øª");
  });
}
</script>

</body>
</html>